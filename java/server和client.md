## jvm server模式和client模式

（1）指定jvm启动模式

jvm如果不显式的指定server或者client，jvm会根据自己的原则自动判断

（2）区别

* 编译器方面：

  当虚拟机运行在clint模式时，使用的是代号为c1的轻量级编译器；c1注重的是编译的速度，c2注重的是编译代码的质量

  server模式时，使用的是相对重量级的c2的编译器；c2的编译器相对于c1编译器，编译更加彻底，服务启动起来之后，性能更好

* gc方面

  client模式下的新生代serial收集器，和老年代的serial old选择的都是串行的gc

  server模式下，新生代选择并行回收gc，老年代选择并行gc

* 启动方面

  client模式启动块，编译快，内存占用少，针对桌面应用程序设计，优化客户端环境的启动时间。

  server模式启动慢，编译更完全，编译器使用的是只适应的编译器，效率更高，针对桌面端应用设计，优化服务器环境的最大化程序启动速度。



垃圾回收器的选择

* 吞吐量优先
* 停顿时间/响应时间优先

美团的gc回收案例

>明确优化目标
>
>>高可用：可用性达到若干个9
>>
>>低延迟：请求必须多少毫秒内完成响应   cms concurrentmarksweep，并发标记，stw的时间最短
>>
>>高吞吐：每秒完成多少次事务
>>
>>以上几点性能指标可能冲突
>
>衡量标准
>
>>通过量化指标实现：
>>
>>gc时间对于响应时间和可用性的影响，评估gc优化后对响应时间的收益



比较关注的点：高可用和低延迟



client模式通过-client参数指定，server模式通过-server参数指定



使用jit编译器，jit编译器会选择代码块，编译成本地代码，运行速度更快

-server模式启动时，速度较慢，但是运行起来，





解释+编译

jdk7之后，默认采用分层编译策略，这时候，client和server会配合工作

第0层：程序解释执行，解释器不开启性能监控

第一层：采用c1编译，进行简单，可靠的优化

第二层：采用c2编译，会启用一些编译耗时较长的优化，根据性能监控信息进行一些不可靠的激进优化